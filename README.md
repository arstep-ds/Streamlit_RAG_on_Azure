# Streamlit OpenAI Integration with Azure Search and RAG

This repository contains a Streamlit application that integrates with the OpenAI API and Azure Search to process user input and display responses with a typewriter effect. The application allows users to ask questions and receive answers generated by OpenAI, potentially enhanced by data retrieved from Azure Search.

## Features

- **Typewriter Effect**: Displays the generated response word-by-word with a slight delay.
- **Background Image**: Sets a local image as the background for the Streamlit app.
- **OpenAI Integration**: Uses OpenAI's API for generating responses.
- **Azure Search Integration**: Configured to use Azure Search for retrieving relevant data to enhance responses.

## Prerequisites

- Python 3.7 or later
- Streamlit
- OpenAI Python client library
- Azure OpenAI and Search credentials

## Installation

1. **Clone the Repository**:
   ```bash
   git clone https://github.com/arstep-ds/Streamlit_RAG_on_Azure.git
   cd Streamlit_RAG_on_Azure
2. **Install Dependencies**:
   ```bash
   pip install -r requirements.txt
3. **Set Up Environment Variables**:
To run this application, you need to set up several environment variables. These variables store your Azure OpenAI and Azure Search credentials. You can manage these variables using a `.env` file.

Create a `.env` file in the root directory of your project and add the following content:

```plaintext
# Azure OpenAI API key
AZURE_OPENAI_API_KEY=your_azure_openai_api_key

# Azure AI Search endpoint
AZURE_AI_SEARCH_ENDPOINT=https://your-azure_ai-search-endpoint.search.windows.net

# Azure AI Search index name
AZURE_AI_SEARCH_INDEX_NAME=your_azure_search_index_name

# Azure AI Search API key
AZURE_AI_SEARCH_API_KEY=your_azure_ai_search_api_key
```
Replace the placeholder values (your_azure_openai_api_key, https://your-azure_ai-search-endpoint.search.windows.net, your_azure_search_index_name, your_azure_ai_search_api_key) with your actual credentials and endpoint information.

4. **Set Up Background Image**:
   Place your desired background image in the project directory and update the image path in main():
   set_png_as_page_bg("path_to_your_local_background_image.gif")

## Usage

1. **Run the Application**:
   ```bash
   streamlit run app.py
2. **Interact with the App:**:
   * Open your web browser and navigate to the Streamlit app (usually http://localhost:8501).
   * Enter your question in the input box and click "Submit".
   * The response will be displayed with a typewriter effect

## Code Explanation

### Typewriter Function
```python
def stream_data(answer):
    for word in answer.split(" "):
        yield word + " "
        time.sleep(0.02)
```
This function yields each word of the input string with a slight delay, creating a typewriter effect.

### Background Image Functions
```python
@st.cache(allow_output_mutation=True)
def get_base64_of_bin_file(bin_file):
    with open(bin_file, 'rb') as f:
        data = f.read()
    return base64.b64encode(data).decode()

def set_png_as_page_bg(png_file):
    bin_str = get_base64_of_bin_file(png_file)
    page_bg_img = '''
    <style>
    body {
    background-image: url("data:image/png;base64,%s");
    background-size: cover;
    }
    </style>
    ''' % bin_str
    
    st.markdown(page_bg_img, unsafe_allow_html=True)
    return
```
These functions handle loading a background image from a local file, converting it to a base64 string, and setting it as the page background using CSS.

### Processing User Input
```python 
def process_string(input_string: str):
    client = openai.AzureOpenAI(
        azure_endpoint="https://YOUR-ENDPOINT.openai.azure.com",
        api_key="YOUR_AZURE_OPENAI_API_KEY",
        api_version="YOUR_VERSION"
    )
    completion = client.chat.completions.create(
        model="YOUR_MODEL",
        messages=[
            {"role": "user", "content": input_string}
        ],
        extra_body={
            "data_sources":[
                {
                    "type": "azure_search",
                    "parameters" : {
                        "endpoint":"https://YOUR-AZURE_AI-SEARCH-ENDPOINT.search.windows.net",
                        "index_name": "YOUR_AZURE_SEARCH_INDEX_NAME",
                        "authentication":{
                            "type": "api_key",
                            "key": "YOUR_AZURE_AI_SEARCH_API_KEY",
                        }
                    }
                }
            ]
        }
    )

    output = completion.choices[0].message.content
    return output
```
This function sends the user input to the OpenAI API using the Azure endpoint, processes the response, and returns the output.

```python
extra_body={
    "data_sources":[
        {
            "type": "azure_search",
            "parameters" : {
                "endpoint":"https://YOUR-AZURE_AI-SEARCH-ENDPOINT.search.windows.net",
                "index_name": "YOUR_AZURE_SEARCH_INDEX_NAME",
                "authentication":{
                    "type": "api_key",
                    "key": "YOUR_AZURE_AI_SEARCH_API_KEY",
                }
            }
        }
    ]
}
```
This part of the code intends to use Azure Search as a data source. Azure Search could serve as the retrieval mechanism in a RAG system, fetching relevant documents or data based on the input query.

### Streamlit Application
```python
def main():
    set_png_as_page_bg("PATH_TO_YOUR_LOCAL_BACKGROUND_IMAGE.gif")

    form = st.form(key="my_form")
    user_input = form.text_input(label="Your question:")
    submit_button = form.form_submit_button(label="Submit")

    if submit_button:
        result = process_string(user_input)
        st.write_stream(stream_data(result))

if __name__ == "__main__":
    main()
```
This section sets up the Streamlit app, handles user input, processes the input, and displays the response with a typewriter effect.

## License
This project is licensed under the MIT License. See the LICENSE file for details.